/*! For license information please see datavision.min.js.LICENSE.txt */
var DataVision;(()=>{"use strict";var t=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e={};(()=>{function a(t,e){const a=e.x-t.x,i=e.y-t.y;return Math.hypot(a,i)}function i(t,e){const a=Math.min(...e),i=Math.max(...e);return t<a?a:t>i?i:t}function n(t){if("number"!=typeof t||isNaN(t))return t;const e=t.toString().split(".");return e[0]=e[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}function s(t,e){return"avg"===t?function(t){return t.reduce(((t,e)=>t+e),0)/t.length}(e):"min"===t?Math.min(...e):"max"===t?Math.max(...e):"count"===t?e.length:function(t){return t.reduce(((t,e)=>t+e),0)}(e)}function l(t){return t?t.every((t=>"number"==typeof t)):null}function o(t,e){if("number"!=typeof t||isNaN(t))return t;const a=parseFloat(t);let i=a;if(Number.isInteger(a))i=a.toFixed(e||0);else{const t=a.toString(),n=t.indexOf(".");if(-1!==n){const s=t.substring(n+1).search(/[^0]/);if(-1===s)i=a.toFixed(0);else{const t=isNaN(e)?s+1:e;i=a.toFixed(t)}}else i=parseFloatparsedNumber}return parseFloat(i)}function r(t,e,a={x:0,y:0}){const i=Math.PI/180*t;return{x:a.x+e*Math.cos(i),y:a.y+e*Math.sin(i)}}function c(t){if(l(t)){const e=function(t){if(t){const e=t.filter((t=>"number"==typeof t&&!isNaN(t)));if(0===e.length)return;return{min:Math.min(...e),max:Math.max(...e)}}return null}(t);if(e)return[e.min,e.max]}return[null,null]}function h(t,e,a,i,n){!i&&(i="x1"),!n&&(n="y1");const s=t.getLayout().axisData,l=s.labels[i],o=s.values[n];let r=!1,c=!1;if(l){const t=l.range;if(t){const a=t[0],i=t[1];(e<a||e>i)&&(r=!0)}}if(o){const t=o.range;if(t){const e=t[0],i=t[1];(a<e||a>i)&&(c=!1)}}return r||c}function u(t,e,a,i,n){return{x:g(t,e,n),y:d(t,a,i)}}function g(t,e,a){const n=t.getLayout(),s=t.getStyle().label.fontSize,l=n.graphPosition,o=l.x,r=l.width;!a&&(a="x1");const c=n.axisData.labels[a];if(c){const a=c.isAllNumbers,n=c.values;if(a)e=function(t,e,a){const n=t.getLayout(),s=n.graphPosition,l=s.x,o=s.width;!a&&(a="x1");const r=n.axisData.labels[a];if(r){const t=r.range;if(t){const a=t[0],n=t[1]-a;return l+(i(e,t)-a)/n*o}}return e}(t,e);else{let t=r/n.length;t<s&&(t=s);const a=t/2,i=n.indexOf(e);i>=0&&(e=o+(t*i+a))}}return e}function d(t,e,a){const n=t.getLayout(),s=t.getStyle().label.fontSize,l=n.graphPosition,o=l.y,r=l.height;!a&&(a="y1");const c=n.axisData.values[a];if(c){const n=c.isAllNumbers,l=c.values;if(n)e=function(t,e,a,n){const s=t.getLayout(),l=s.graphPosition,o=l.y,r=l.height;!a&&(a="y1");const c=s.axisData.values[a];if(c){const t=c.range;if(t){const a=t[0],n=t[1]-a;return o+r-(i(e,t)-a)/n*r}}return e}(t,e,a);else{let t=r/l.length;t<s&&(t=s);const a=t/2,i=l.indexOf(e);i>=0&&(e=o+r-(t*i+a))}}return e}function x(t,e){let a=Math.round(.5*Math.min(t,e));return a<0&&(a=0),a}function f(t,e,a,i){t&&"object"==typeof t&&(t.addEventListener?(y(t,e,a)||t.addEventListener(e,a,!1),i&&!y(t,i,a)&&t.addEventListener(i,a,!1)):t.attachEvent&&(y(t,e,a)||t.attachEvent("on"+e,a),i&&!y(t,i,a)&&t.attachEvent("on"+i,a)))}function y(t,e,a){return t._eventHandlers&&t._eventHandlers[e]&&t._eventHandlers[e].includes(a)}function m(t,e){return t.length>e?t.substr(0,e>3?e-2:e)+"..":t}function p(t,e){const a=e.width>=0?e.x:e.x+e.width,i=e.height>=0?e.y:e.y+e.height,n=Math.abs(e.width),s=Math.abs(e.height);return t.x<a+n&&t.x+t.width>a&&t.y<i+s&&t.y+t.height>i}function b(t,e){const i=e.radius;return a(t,e.midPoint)<=i}function v(t,e,i){const n=Math.max(e.radius,i),s={midPoint:e.midPoint,radius:n},l=a(t,e.midPoint);return!!b(t,s)&&{dist:l,data:e}}function A(t,e){const a={radius:e.holeRadius,midPoint:e.midPoint};if(b(t,e)&&!b(t,a)){const a=e.startDegrees>0?e.startDegrees:e.startDegrees+360,r=e.midPoint,c=e.endDegrees>0?e.endDegrees:e.endDegrees+360;return i=((i=(l=r,o=t,(Math.atan2(o.y-l.y,o.x-l.x)*(180/Math.PI)+360)%360))+360)%360,(n=((n=a)+360)%360)<=(s=((s=c)+360)%360)?i>=n&&i<=s:i>=n||i<=s}return!1;var i,n,s,l,o}t(e);const T={get:function(t){const e=this.colors.length,a=t/e%1;return this.colors[Math.round(a*e)]},colors:[{name:"Royal Blue",code:"#4169E1"},{name:"Emerald Green",code:"#008000"},{name:"Coral Orange",code:"#FF6B57"},{name:"Crimson Red",code:"#DC143C"},{name:"Lavender Purple",code:"#E6E6FA"},{name:"Tangerine Orange",code:"#FFA500"},{name:"Turquoise Blue",code:"#40E0D0"},{name:"Bubblegum Pink",code:"#FF69B4"},{name:"Lime Green",code:"#00FF00"},{name:"Amethyst Purple",code:"#9966CC"},{name:"Goldenrod Yellow",code:"#DAA520"},{name:"Aqua Blue",code:"#00FFFF"},{name:"Teal Green",code:"#008080"},{name:"Sapphire Blue",code:"#082567"},{name:"Ruby Red",code:"#E0115F"},{name:"Emerald Green",code:"#50C878"},{name:"Golden Yellow",code:"#FFD700"},{name:"Violet Purple",code:"#8A2BE2"},{name:"Mint Green",code:"#98FF98"},{name:"Plum Purple",code:"#DDA0DD"}]};function S(t){if(!t)return{count:0,range:t};const e=t[0],a=t[1];let i=e,n=a,s=5,l=0;if(!isNaN(i)&&!isNaN(n)){let t=0;i<=0&&n>=0?t=Math.max(Math.abs(e)+Math.abs(a))/Math.max(4,1):i<=0?t=Math.abs(i/Math.max(4,1)):i>0&&(t=n/Math.max(4,1)),l=function(t,e){const a=[1,2,4,5,10],i=Math.pow(10,Math.floor(Math.log10(t)));return a.find((e=>e*i>=t))*i}(t);const o=function(t,e){let a=t[0],i=t[1];return a=e*Math.floor(a/e),i=e*Math.ceil(i/e),[a,i]}([i,n],l);i=o[0],n=o[1];const r=n-i;s=Math.round(r/l),s<=1&&(i=0,s=Math.round(n/l))}return{count:s,range:[i,n],interval:l}}function w(t,e,a){if(a.length>0)for(let t=0;t<a.length;t++){const i=a[t];e.push(i)}else for(var i=0;i<t.length;i++)e.push(i)}function P(t,e){let a="y1"===e||"yAxis"===e?"yAxis":"";return a="y2"===e||"y2Axis"===e?"y2Axis":a,a="x1"===e||"xAxis"===e?"xAxis":a,t[a]}function D(t,e,a){const i=e||{},n=T.get(a).code;return!i.color&&(i.color=n),"line"===t&&Array.isArray(i.color)&&(i.color=n),!i.size&&(i.size=3),i}const C=t=>{const e=t.getCtx(),a=t.getLayout(),i=t.getStyle().label,n=e.canvas,s=n.width,l=n.height,o=i.fontSize;e.font=o+"px "+i.fontFamily;let r=o+o/2;const c=a.graphPosition,h=c.x,u=c.y,g=c.width,d=c.height,x=.2*s,f=h+g+c.yAxisRight+o,y=t.getData();let p=!1;if(1===y.length){const t=y[0];"bar"===t.type&&t.names.length>1&&(p=!0)}if(y.length>1||!a.hasAxisData||p){let a=u+o/2,i=0;for(let t=0;t<y.length;t++){const e=y[t];i+=(e.names||[e.name||""]).length}const n=i*r,c=t.getDatasetNamesScrollTop()/n*i,h=Math.floor(c);a-=o*(c-h);const g=f-o/2;e.clearRect(g,u,s-g,d);for(let t=0;t<y.length;t++){const i=y[t];if(i){let t=i.labels;const n=i.type;let s=i.colors;if(["line","bar","scatter","bubble"].includes(n))if("bar"===n)t=i.names,s=i.colors;else{t=[i.name];const e=i.design.color;s=Array.isArray(e)?e:[e]}if(t)for(let i=h;i<t.length;i++){const n=T.get(i).code;let l=t[i];const c=e.measureText(l).width;if(c+r>x&&l.length>3){const t=c/l.length;l=m(l,Math.floor((x-2*o)/t))}const h=(s?s[i]:null)||n;h&&(e.fillStyle=h);const u=f+o,g=a;e.beginPath(),e.arc(f,a,o/2,0,2*Math.PI),e.fill(),e.beginPath(),e.fillStyle="black",e.textAlign="start",e.textBaseline="middle",e.fillText(l,u,g),a+=r}}}e.clearRect(g,0,s-g,u),e.clearRect(g,u+d,s-g,l-(u+d)),t.addDatasetNamesScrollBar({x:g,y:u,width:s-g,height:d},n)}},N=t=>{const e=t.getLayout();(t=>{const e=t.getCtx(),a=t.getLayout(),i=t.getStyle().title,n=t.getCanvas().width,s=a.graphPosition.y;let l=a.titleLines;if(e.textAlign="center",l){const t=i.fontSize;e.font=t+"px "+i.fontFamily;let a=n/2,o=s/2+t/2;l.length>1&&(o=t);for(let i=0;i<l.length;i++){const n=l[i];e.beginPath(),e.fillText(n,a,o),e.closePath(),o+=t}}})(t),e.hasAxisData&&(t=>{const e=t.getCtx(),a=t.getLayout().graphPosition;e.beginPath(),e.strokeStyle="#b5b5b5",e.lineWidth="0.1",e.rect(a.x+1,a.y,a.width-2,a.height),e.stroke(),e.lineWidth="1",function(t,e){const a=t.getCtx(),i=t.getLayout(),s=t.getCanvas(),l=(s.width,s.height,t.getStyle().label),r=e.width,c=e.height,h=e.x,u=e.y,g=e.maxLabelWidth,d=l.fontSize;a.font=d+"px "+l.fontFamily,a.textBaseline="hanging";let x=0,f=u+c;const y=i.axisData.labels;for(let t in y){const e=y[t],i=e.values;if(e.isAllNumbers){const t=e.tickData;i.sort(((t,e)=>t-e));let s=e.range;if(s){const i=e.tickFormat||{},l=i.prefix||"",g=i.suffix||"",y=s[0],m=s[1],p=t.interval;let b=t.count,v=r/b;v<1&&(v=1);let A=0;const T=a.measureText(m).width;let S=1;T>v&&(S+=Math.round(T/v)),a.textAlign="center";for(let t=0;t<=b;t+=S){A=l+n(o(y+p*t,i.decimalPlaces))+g,x=h+v*t,a.measureText(A).width;const e=x,s=f+d;a.beginPath(),a.strokeStyle="0"===A?"black":"#b5b5b5",a.moveTo(x,u),a.lineTo(x,u+c+d/2),a.stroke(),a.beginPath(),a.fillText(A,e,s)}}}else{const t=e.maxWidth;let n=r/i.length;n<d&&(n=d);let s=1;for(var p=0;p<i.length;p+=s){x=h+(n/2+n*p);let e=x;const s=f+d;a.beginPath(),a.textAlign="center";let l=i[p],o=0;const r=a.measureText(l).width/l.length;n/d<4?(l=m(l,(g-d)/r),o=-90,e=x,a.textAlign="end",a.textBaseline="middle"):t>n&&(l=m(l,n/r));let c=o*(Math.PI/180);a.save(),a.translate(e,s),a.rotate(c),a.fillText(l,0,0),a.restore()}}}a.textAlign="start",a.textBaseline="alphabetic"}(t,a),function(t,e){const a=t.getCtx(),i=(t.getCanvas(),t.getLayout()),s=t.getStyle().label,l=e.width,r=e.height,c=e.x,h=e.y,u=e.maxLabelWidth,g=s.fontSize;a.font=g+"px "+s.fontFamily;let d=c,x=h+r;const f=i.axisData.values;for(let t in f){const e=f[t],i=e.values;if(e.isAllNumbers){const s=e.tickData;i.sort(((t,e)=>t-e));let u=e.range;if(u){const i=e.tickFormat||{},f=i.prefix||"",y=i.suffix||"",m=u[0],p=s.interval;let b=s.count,v=r/b;v<1&&(v=1);let A=0,T=1;g>v&&(T+=Math.round(g/v));for(let e=0;e<=b;e+=T){A=f+n(o(m+p*e,i.decimalPlaces))+y,x=h+r-v*e;const s=a.measureText(A).width,u="y2"===t?d+l+g:d-s-g,b=x+Math.floor(g/2);a.beginPath(),a.strokeStyle="0"===A?"black":"#b5b5b5","y2"===t?(a.moveTo(c+l,x),a.lineTo(c+l+g/2,x)):(a.moveTo(c+l,x),a.lineTo(c-g/2,x)),a.stroke(),a.beginPath(),a.fillText(A,u,b)}}}else{const n=e.maxWidth;let s=r/i.length;s<g&&(s=g);let o=1;g>s&&(o+=Math.round(g/s));for(var y=0;y<i.length;y+=o){x=h+r-(s/2+s*y);let e=i[y];const o=a.measureText(e).width/e.length;n>u-g&&(e=m(e,(u-g)/o));const c="y2"===t?d+l+g:d-g,f=x;a.beginPath(),a.textAlign="y2"===t?"start":"end",a.textBaseline="middle",a.fillText(e,c,f),a.textAlign="start",a.textBaseline="alphabetic"}}}}(t,a),function(t,e){const a=t.getCtx(),i=t.getLayout(),n=t.getStyle().label,s=a.canvas.height,l=e.width,o=e.height,r=e.x,c=e.y,h=e.yAxisRight;let u=i.yAxis,g=i.y2Axis,d=i.xAxis;a.textAlign="center";const x=n.fontSize;if(a.font=x+"px "+n.fontFamily,u){let t=u.title;if(t){a.beginPath();let e=Math.PI/180*-90;a.save(),a.translate(x,c+o/2),a.rotate(e),a.fillText(t,0,0),a.restore()}}if(g){let t=g.title;if(t){a.beginPath();let e=Math.PI/180*-90;a.save(),a.translate(r+l+h-x,c+o/2),a.rotate(e),a.fillText(t,0,0),a.restore()}}if(d){let t=d.title;t&&(a.beginPath(),a.fillText(t,r+l/2,s-x/2))}}(t,a)})(t),e.hasPieData&&(t=>{const e=t.getCtx(),a=t.getLayout().graphPosition,i=a.x,n=a.y,s=a.width,l=x(s,a.height),o=i+s/2,r=n+l;e.beginPath(),e.arc(o,r,l,0,2*Math.PI),e.stroke()})(t)},k=(t,e,a,n,s,l,o,r)=>{const c=t.getCtx(),h=t.getLayout(),u="hr"===e.direction,x=h.axisData,f=x.values[e.yAxis],y=x.labels[e.xAxis],m="y2"===e.yAxis?"y2Axis":"yAxis",p=h.xAxis?h.xAxis.title:null,b=h[m]?h[m].title:null,v=e.name||"",A=h.graphPosition,T=A.x,S=A.y,w=A.height;let P=u?y.range:f.range;const D=i(0,P),C=(P?u?g(t,D):d(t,D):null)||(u?T:S+w);if(u){const e=l,i=C,h=d(t,n)+o*l/2-e*a-e,u=g(t,s)-C,x=e;c.beginPath(),c.rect(i,h,u,x),c.fill(),t.setToolTipData({type:"bar",x:i,y:h,width:u,height:x,label:n,value:s,labelName:v,valueName:b,tickFormat:r})}else{const e=l;let i=g(t,n)-o*l/2+e*a;const h=d(t,s),u=i,x=h,f=e,y=C-h;c.beginPath(),c.rect(u,x,f,y),c.fill(),t.setToolTipData({type:"bar",x:u,y:x,width:f,height:y,label:n,value:s,labelName:p,valueName:v,tickFormat:r})}},M=(t,e,a,i,n,s,l,o)=>{const r=t.getCtx(),c=t.getLayout(),h="hr"===e.direction,u=c.axisData,x=u.values[e.yAxis],f=u.labels[e.xAxis],y="y2"===e.yAxis?"y2Axis":"yAxis",m=c.xAxis?c.xAxis.title:null,p=c[y]?c[y].title:null,b=e.name||"",v=c.graphPosition,A=v.x,T=v.y,S=(v.width,v.height),w=((h?f.range:x.range)?h?g(t,n):d(t,n):null)||(h?A:T+S);if(h){const e=a,n=w,c=d(t,i)+a/2-e,h=g(t,s)-w,u=e;r.beginPath(),r.rect(n,c,h,u),r.fill(),t.setToolTipData({type:"bar",x:n,y:c,width:h,height:u,label:i,value:l,labelName:b,valueName:p,tickFormat:o})}else{const e=a;let n=g(t,i)-a/2;const c=d(t,s),h=n,u=c,x=e,f=w-c;r.beginPath(),r.rect(h,u,x,f),r.fill(),t.setToolTipData({type:"bar",x:h,y:u,width:x,height:f,label:i,value:l,labelName:m,valueName:b,tickFormat:o})}},F=(t,e,a,i,n,s)=>{const l=e.mode,o=t.getCtx();o.lineWidth=i,n&&("start"===a?(o.beginPath(),o.moveTo(n.x,n.y)):o.lineTo(n.x,n.y),"scatter"!==l||s||(o.stroke(),o.closePath(),o.beginPath(),o.arc(n.x,n.y,i/2||1,0,2*Math.PI),o.stroke(),o.closePath(),o.beginPath(),o.moveTo(n.x,n.y))),"end"===a&&(o.stroke(),o.closePath())},L=(t,e,a)=>{const i=t.getCtx();a&&(i.beginPath(),i.arc(a.x,a.y,e,0,2*Math.PI),i.stroke(),i.fill(),i.closePath())},z=(t,e,a,i,n,s,l,o,c,h)=>{const u=t.getLayout().graphPosition,g=u.x,d=u.y,f=u.width,y=x(f,u.height),m=g+f/2,p=d+y,b=r(a,y,{x:m,y:p}),v={x:m,y:p},A=r(i,y,{x:m,y:p}),T=Math.PI/180,S=a*T,w=i*T;e.beginPath(),e.strokeStyle=h,e.lineWidth=2,e.lineCap="round",e.lineJoin="round",e.arc(v.x,v.y,y,S,w),e.moveTo(b.x,b.y),e.lineTo(v.x,v.y),e.lineTo(A.x,A.y),e.stroke(),e.fill(),e.closePath(),t.setToolTipData({type:"pie",radius:y,startDegrees:a,endDegrees:i,startAngle:S,endAngle:w,midPoint:v,holeRadius:n,label:s,value:l,percent:o,tickFormat:c})},W=(t,e)=>{const a=t.getCtx(),n=t.getLayout(),l=t.getStyle().label.fontSize,r=e.type,c=e.mode;if("bar"===r){const s=n.axisData,o=e.dataset,r="hr"===e.direction,h=o.length,u=n.graphPosition,g=r?u.height:u.width,d=new Map;for(let n=0;n<o.length;n++){const u=o[n];u.direction=e.direction;const x=s.values[u.yAxis],f=s.labels[u.xAxis],y={label:f.tickFormat,value:x.tickFormat};let m=g/f.values.length;m<l&&(m=l);let p="stack"===c?.7*m:m/(h+1);const b=r?x:f;if(b.isAllNumbers){const t=b.range,a=t[0],i=t[1]-a,n=e.barSize;n&&(p=n/i*g)}const v=u.design.color;a.fillStyle=v;let A=0;const T=i(0,r?f.range:x.range);u.values.forEach(((e,i)=>{if(Array.isArray(e)&&(e=e[0]),Array.isArray(v)&&(a.fillStyle=v[A>=v.length?0:A]),"stack"===c){const a=d.has(i)?d.get(i):[T,T],s=e>=0?a[0]:a[1],l=e,o=(e=0===n?e:s+e)>=0?[e,a[1]]:[a[0],l];d.set(i,o),M(t,u,p,i,s,e,l,y)}else k(t,u,n,i,e,p,h,y);A++}))}}else if("pie"===r){const i=n.axisData,l=e.yAxis?e.yAxis:"y1",r=e.xAxis?e.xAxis:"x1",c=i.values[l],h={label:i.labels[r].tickFormat,value:c.tickFormat},u=t.getTempCanvas();u.width=a.canvas.width,u.height=a.canvas.height;const d=u.getContext("2d"),x=n.graphPosition,f=x.x,y=x.y,m=x.width,p=x.height,b=Math.min(m,p)/2,v=e.values?e.values:[],A=e.colors,S=e.operation;let w=0;const P=[];v.forEach((t=>{const e=s(S,t);P.push(e),w+=e}));const D=(e.hole?e.hole:0)*b;if(P){let a=-90,i=a;for(var g=0;g<P.length;g++){const n=T.get(g).code,s=A?A[g]:n;s&&(d.fillStyle=s);const l=P[g],r=e.labels[g];if(!isNaN(l)){const e=l/w;a+=360*e;const n=a,c=o(100*e);z(t,d,i,n,D,r,l,c,h,s),i=n}}}const C=m/2,N=p/2;d.globalCompositeOperation="destination-out",d.globalAlpha=1,d.beginPath(),d.arc(f+C,y+N,D,0,2*Math.PI),d.fill(),d.globalCompositeOperation="source-over",a.drawImage(u,0,0)}else if(e){const i=e.yAxis?e.yAxis:"y1",s=e.xAxis?e.xAxis:"x1",l=n.xAxis?n.xAxis.title:null,o=e.name||"",c="hr"===e.direction,d=e.design.color,x=e.design.size,f=e.design.text;a.fillStyle=d,a.strokeStyle=d;const y=c?e.values:e.labels,m=c?e.labels:e.values?e.values:[];if(y){let c,p={x:null,y:null};for(g=0;g<y.length;g++){let b=y[g],v=m[g];const A=Array.isArray(d)?d[g]?d[g]:d[0]:d,T=Array.isArray(x)?x[g]:x,S=Array.isArray(f)?f[g]:f;if(c=0===g?"start":g===y.length-1?"end":"",v||0===v){const g=u(t,b,v,i,s),d=h(t,b,v,s,i);if("line"===r){if(d&&(g.x===p.x||g.y===p.y)){a.stroke(),a.closePath();break}d||(F(t,e,c,T,g,d),p=g)}else if(("scatter"===r||"bubble"===r)&&!d){const i=e.design.line,n=i&&i.color?i.color:A,s=i&&i.size?i.size:0;a.fillStyle=A,a.strokeStyle=n,a.lineWidth=s,L(t,T,g)}const x=n.axisData.labels[s],f=n.axisData.values[i],y={label:x.tickFormat,value:f.tickFormat};!d&&t.setToolTipData({type:r,radius:T,midPoint:g,label:b,value:v,labelName:l,valueName:o,size:"bubble"===r?T:null,sizeName:S,color:A,tickFormat:y})}else a.stroke(),a.closePath()}}}},B=(t,e)=>{e&&W(t,e)},E=(t,e)=>{e&&W(t,e)},I=(t,e,a,i)=>{if(!t[a]&&0!==t[a])return{text:null,width:0};const s=e.canvas.width;let l=t[a+"Text"],r=t[a+"Width"];const c=t.tickFormat?t.tickFormat[a]:{},h=c.prefix||"",u=c.suffix||"",g=c.decimalPlaces;if(!r){let c=h+n(o(t[a],g))+u;const d=e.measureText(c).width,x=d>s?.9*s:d;c=m(c,x/(d/c.length));let f=t[a+"Name"];f&&(f=m(f,(s-x-i||0)/(e.measureText(f).width/f.length))+": "),l=(f?f+" ":"")+c+(t.percent&&"value"===a?" ("+t.percent+"%)":""),r=e.measureText(l).width}return t[a+"Text"]=l,t[a+"Width"]=r,{text:l,width:r}},R=(t,e,a,i)=>{((t,e,a)=>{if(e.beginPath(),e.strokeStyle="#000",e.lineWidth=1,"bar"===a.type)e.rect(a.x,a.y,a.width,a.height);else if("pie"===a.type){e.strokeStyle="rgba(0, 0, 0, 0.1)";const t=.0063*e.canvas.width;e.lineWidth=t,e.arc(a.midPoint.x,a.midPoint.y,a.radius-2,a.startAngle,a.endAngle)}else"line"===a.type?(e.strokeStyle=a.color||"#000",e.fillStyle=a.color||"transparent",e.arc(a.midPoint.x,a.midPoint.y,a.radius+1,0,2*Math.PI),e.fill()):e.arc(a.midPoint.x,a.midPoint.y,a.radius,0,2*Math.PI);e.stroke()})(0,e,i);const n=t.getStyle().label.fontSize,s=n/2,l=I(i,e,"label",n),o=I(i,e,"value",n),r=I(i,e,"size",n),c=Math.max(l.width,o.width,r.width)+n,h=n*(r.text?5:3.5);let u=a.x+20,g=a.y+25;const d=c,x=h,f=u+d,y=g+x;f>e.canvas.width&&(u=d+n+20<a.x?a.x-(d+20):a.x+20-(f-e.canvas.width)),y>e.canvas.height&&(g=a.y-(x+20)),e.beginPath(),e.fillStyle="#b5b5b5",e.fillRect(u,g,d,x),e.fillStyle="#fff",e.fillRect(u+1,g+1,d-2,x-2),e.fillStyle="#000",e.font=n+"px Arial",e.textBaseline="top",e.textAlign="left",e.fillText(l.text,u+s,g+s),e.fillText(o.text,u+s,g+2*n),r.text&&e.fillText(r.text,u+s,g+3*n+s)};function O(t){this.rawData=[],this.data=[],this.layout={},this.style={},this.axisScrollBar=document.createElement("div"),this.axisScroll={topIndex:0,leftIndex:0},this.datasetNamesScrollBar=document.createElement("div"),this.datasetNamesScrollTop=0,this.target=document.getElementById(t),this.targetCanvas=document.createElement("canvas"),this.canvas=document.createElement("canvas"),this.canvasCopy=document.createElement("canvas"),this.ctx=null,this.tempCanvas=document.createElement("canvas"),this.toolTipData=[],this.clearTarget=function(){this.getTarget().innerHTML=""},this.setRawData=function(t){this.rawData=t},this.getRawData=function(){return this.rawData},this.setData=function(t){this.data=t},this.getData=function(){return[...this.data]},this.setLayout=function(t){if(t){const e=t.title?t.title:"";t.titleLines=function(t,e){const a=t.getCanvas(),i=t.getCtx(),n=t.getStyle().title,s=a.width,l=e.split(" ");let o=[],r=l[0];const c=n.fontSize;i.font=n.fontWeight+" "+c+"px "+n.fontFamily;for(let t=1;t<l.length;t++){const e=r+" "+l[t];i.measureText(e).width+c<s?r=e:(i.measureText(r).width,o.push(r),r=l[t])}return o.push(r),o}(this,e),t.customColorsIndex=0,this.layout={...t}}},this.getLayout=function(){return this.layout},this.setStyle=function(){this.style=(t=>{const e=t.getCanvas().width,a={fontFamily:"Helvetica Neue, Helvetica, 'Arial, sans-serif",fontWeight:"bold"},i={fontFamily:"Helvetica Neue, Helvetica, 'Arial, sans-serif"};return e<600?(a.fontSize=16,i.fontSize=12):e<1200?(a.fontSize=20,i.fontSize=14):(a.fontSize=24,i.fontSize=18),{title:a,label:i}})(this)},this.getStyle=function(){return this.style},this.setCanvas=function(t,e){const a=this.getCanvas();a.width=t,a.height=e,this.canvas=a,this.ctx=a.getContext("2d")},this.getCanvas=function(){return this.canvas},this.setToolTipData=function(t){this.toolTipData.push(t)},this.getToolTipData=function(){return this.toolTipData},this.clearToolTipData=function(){this.toolTipData=[]},this.updateCanvasCopy=function(){const t=this.getCanvas(),e=this.getCanvasCopy();e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),this.canvasCopy=e},this.getCanvasCopy=function(){return this.canvasCopy},this.getCtx=function(){return this.ctx},this.getTempCanvas=function(){return this.tempCanvas},this.getAxisScroll=function(){return this.axisScroll},this.getAxisScrollbar=function(){return this.axisScrollBar},this.setAxisScroll=function(t,e){const a=this.getLayout(),i=a?a.axisData:null,n=(this.getStyle().label||{}).fontSize||0,s=this.getAxisScroll();if(!isNaN(e)){e<0&&(e=0);let t=0;const a=i.labels||{};for(let e in a){const i=a[e].values;i.length>t&&(t=i.length)}const l=e/(t*n)*t;s.leftIndex=l}},this.addAxisScrollBars=function(){},this.getDatasetNamesScrollTop=function(){return this.datasetNamesScrollTop},this.setDatasetNamesScrollTop=function(t){this.datasetNamesScrollTop=t},this.getDatasetNamesScrollBar=function(){return this.datasetNamesScrollBar},this.addDatasetNamesScrollBar=function(t,e){const a=this.getTarget(),i=this.getDatasetNamesScrollBar(),n=i.children[0]||document.createElement("div");if(n&&(n.style.height=(e||0)+"px",n.style.border="0px",n.style.margin="0px",n.style.padding="0px",n.style.backgroundColor="transparent"),i&&(i.style.position="absolute",i.style.left=(t.x||0)+"px",i.style.top=(t.y||0)+"px",i.style.height=(t.height||0)+"px",i.style.width=(t.width||0)+"px",i.style.border="0px",i.style.margin="0px",i.style.padding="0px",i.style.overflowY="auto",i.style.backgroundColor="transparent"),a&&e>t.height&&i.parentElement!==a){const t=this;let e;f(i,"scroll",(function(){t.setDatasetNamesScrollTop(i.scrollTop),clearTimeout(e),e=setTimeout((function(){C(t),t.updateCanvasCopy()}),10)}),""),i.appendChild(n),a.appendChild(i)}},this.getTarget=function(){return this.target},this.getTargetCanvas=function(){return this.getTarget().getElementsByTagName("canvas")[0]},this.updateTargetCanvas=function(){const t=this.getCanvasCopy(),e=this.getCtx();e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0)},this.addCanvasToTarget=function(){const t=this.getTarget(),e=this.getCanvas();if(t&&e.parentElement!==t){t.style.position="relative";const a=this;f(e,"mousemove",(function(t){t.stopPropagation();const e=function(t){if(t){const e=t.target.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}return null}(t);((t,e,a)=>{if(e&&a){const a=e.getCtx();var i=a.canvas.getBoundingClientRect(),n=t.clientX-i.left,s=t.clientY-i.top;e.updateTargetCanvas();const l=[...e.getToolTipData()].reverse(),o={x:n,y:s,width:1,height:1};let r=null;for(let t=0;t<l.length;t++){const i=l[t],c=i.type;if("bar"===c){if(p(o,i)){R(e,a,{x:n,y:s},i),r=null;break}}else if("pie"===c){if(A(o,i)){R(e,a,{x:n,y:s},i),r=null;break}}else{if(b(o,i)){R(e,a,{x:n,y:s},i),r=null;break}{const t=v(o,i,22);t&&(r?r.dist>t.dist&&(r=t):r=t)}}}r&&R(e,a,{x:n,y:s},r.data)}})(t,a,e)}),"click"),f(document,"click",(function(){a.updateTargetCanvas()}),"touchend"),t.appendChild(e)}},this.clearTarget()}O.prototype.update=function(){this.clearToolTipData(),this.setData(this.getRawData()),function(t){const e=t.getCtx(),a=t.getLayout(),i=t.getData(),n=t.getStyle().label,r=n.fontSize;e.font=r+"px "+n.fontFamily;let h=1,u=0;const g=[],d=[];let x=0;class f{constructor(){this.values=[],this.range=null,this.maxWidth=0,this.tickData=null,this.isAllNumbers=!1}}const y={x1:new f},m={y1:new f,y2:new f},p=["line","bar","scatter","bubble"];let b=!1,v=!1,A=null,T=0,C=0;if(i){const t=i,n=t.length,r={labels:[],values:[]},c={type:"bar",dataset:[],attributeIsSet:!1},f=new Map,S=[],N=[];let k=!1;for(let i=0;i<n;i++){const n={...t[i]},M=n.yAxis||"y1",F=n.xAxis||"x1",L="y2"===M?m.y2:m.y1,z=y[F],W=n.name,B=n.labels?[...n.labels]:[],E=n.values?[...n.values]:[],I=n.type,R=n.design||{},O=n.operation;0===B.length&&w(E,B,r.labels),0===E.length&&w(B,E,r.values),r.labels=[...B],r.values=[...E];let H=0,G=0;const Y={values:new Map,xAxis:F,yAxis:M},_=[],j=[],V=[],q={...n},J=[],X=[],K=l(B),Q=l(E),U=P(a,F),Z=z.tickFormat=U?{...U.tickFormat}:{},$=Z.prefix||"",tt=Z.suffix||"",et=Z.decimalPlaces,at=P(a,M),it=L.tickFormat=at?{...at.tickFormat}:{},nt=it.prefix||"",st=it.suffix||"",lt=it.decimalPlaces;if(p.includes(I)){const a=B.length>0?B.length:E.length;let i="",l="";for(let r=0;r<a;r++){const u=B[r],g=Q?Number(E[r]):E[r]?E[r]:"",d=K?$+o(u,et)+tt:u;let x=u.length>l.length?e.measureText(d).width:null;const y=Q?nt+o(g<0&&g>10?-10:g,lt)+st:g;let m=y.length>i.length?e.measureText(y).width:0;if("bar"===I){if(!c.attributeIsSet){for(let e=0;e<t.length;e++){const a=t[e];"bar"===a.type&&("hr"===a.direction&&(c.direction="hr"),"stack"===a.mode&&(c.mode="stack"))}c.attributeIsSet=!0}const i="hr"===c.direction,l=i?u:g,d=i?g:u,x=i?Q:K,y=i?$:nt,m=i?tt:st,p=i?et:lt;c.labelIsAllNumbers=x;let b=[l];if(Y.values.has(d)&&(b=Y.values.get(d),b.push(l)),(x||d.toString().length>0)&&(b.length>h&&(h=b.length),Y.values.set(d,b),"hr"===n.direction&&(A="hr"),k=!0),r===a-1){if(i?Q:K){let t=Array.from(Y.values.keys());t.sort(((t,e)=>t-e));for(let e=0;e<t.length;e++){const a=t[e],i=t[e!==t.length-1?e+1:null];let n=i?Math.abs(i-a):null;const s=c.barSize;n&&(s?s>n&&(c.barSize=n):c.barSize=n)}}(Q||K)&&Y.values.forEach(((t,a)=>{let n=s(O,t);isNaN(n)&&(n=t[0]);const l=e.measureText(y+o(n,p)+m).width;if(Y.values.set(a,n),"stack"===c.mode){const t=f.has(a)?f.get(a):[0,0];n=(n>=0?t[0]:t[1])+n;const e=n>=0?[n,t[1]]:[t[0],n];f.set(a,e)}i?(z.values.push(n),l>H&&(H=l)):(L.values.push(n),l>G&&(G=l))}))}K&&!Q&&!i&&z.values.push(u),Q&&!K&&i&&L.values.push(g)}else{if(_.includes(u)&&Q){const t=V[_.indexOf(u)];t&&!isNaN(g)&&t.push(g)}else if(j.includes(g)&&!Q&&K){const t=V[j.indexOf(g)];t&&!isNaN(u)&&t.push(u)}else _.push(u),j.push(g),Q?V.push([g]):K&&V.push([u]);if(r===a-1)for(let t=0;t<V.length;t++){const a=V[t],i=s(O,a);isNaN(i)||(Q?(m=e.measureText(nt+o(i,lt)+st).width,j[t]=i,L.values.push(i),m>G&&(G=m)):K&&(x=e.measureText($+o(i,et)+tt).width,_[t]=i,z.values.push(i),x>H&&(H=x)))}}x>H&&(H=x,l=u),m>G&&(G=m,i=g),(!K||Q)&&z.values.push(u),(!Q||K)&&L.values.push(g)}z.maxWidth=H>z.maxWidth?H:z.maxWidth,L.maxWidth=G>L.maxWidth?G:L.maxWidth,L.isAllNumbers=Q,z.isAllNumbers=K,b=!0;const r=W||"Dataset "+x,u=e.measureText(r).width;"bar"===I?(S.push(r),Y.name=r,Y.design=D(I,R,x),Y.design.color&&N.push(Array.isArray(Y.design.color)?Y.design.color[0]:Y.design.color),c.dataset.push(Y)):(n.name=r,n.values=j,n.labels=_,n.design=D(I,R,x),g.push(n)),u>T&&(T=u),C+=1,x++}else if("pie"===I){for(let t=0;t<E.length;t++){const a=B[t],i=E[t];if(i>=0&&a){const t=e.measureText(a).width;J.includes(a)?X[J.indexOf(a)].push(i):(J.push(a),X.push([i])),t>u&&(u=t)}}v=!0,q.labels=J,q.values=X,q.names=J,q.type="pie",d.push(q),u>T&&(T=u),C+=J.length}z&&(z.values=[...new Set(z.values)]),L&&(L.values=[...new Set(L.values)])}k&&(c.names=S,c.colors=N,c.direction=A,g.unshift(c))}const N=(t,i)=>{for(let n in t){const s=t[n],r=s.values,h=s.maxWidth,u=l(r);let g=c(r);if("values"===i){if("y2"===n){if(a.y2Axis){const t=a.y2Axis.range;!t||(g=t)}}else if(a.yAxis){const t=a.yAxis.range;!t||(g=t)}}else if(a.xAxis){const t=a.xAxis.range;!t||(g=t)}const d=S(g),x=d.range,f=x[0],y=x[1];let m=h;if(u){const t=s.tickFormat,a=t?t.decimalPlaces:null,i=t&&t.prefix||"",n=t&&t.suffix||"";if(!isNaN(f)&&!isNaN(y)){const t=e.measureText(i+o(f,a)+n).width,s=e.measureText(i+o(y,a)+n).width;m=Math.max(t,s)}}s.maxWidth=m,s.range=d.range,s.tickData=d,s.isAllNumbers=u}},k=[...g,...d];N(m,"values"),N(y),a.datasetNameData={isDatasetName:C>1,maxNameWidth:T,total:C},a.axisData={labels:y,values:m,direction:A},a.hasAxisData=b,a.hasPieData=v,t.setData(k)}(this),function(t){t.getCtx();const e=t.getCanvas(),a=e.width,i=e.height,n=t.getLayout(),s=t.getStyle(),l=s.title.fontSize,o=s.label.fontSize,r=t.getLayout().titleLines;let c=0;r.length>0&&(c=(r.length+1)*l);const h=n.axisData,u=h.labels,g=h.values,d=2*o,x=.15*a;let f=x,y=x;const m=g.y1.maxWidth;m<f&&(f=m+d),n.yAxis&&n.yAxis.title&&(f+=d);const p=g.y2.maxWidth;p<y&&(y=0===p?0:p+d),n.y2Axis&&n.y2Axis.title&&p>0&&(y+=2*o);let b=.15*a;const v=n.datasetNameData,A=v.isDatasetName,T=v.maxNameWidth;b=A?T<b?T+d:.2*a:0;let S=d+o,w=0;const P=a-(f+y+b),D=u.x1,C=D.maxWidth,N=P/D.values.length;if(w=D.isAllNumbers?C:0,!D.isAllNumbers&&N/o<4){const t=.3*i;S+=C>t?t:2*o}n.xAxis&&n.xAxis.title&&(S+=d);const k={x:f,y:c,width:a-(f+y+b+w),height:i-(c+S),yAxisRight:y,maxLabelWidth:x};t.layout={...n,graphPosition:k}}(this),C(this),N(this),(t=>{const e=t.getCtx(),a=t.getData();for(let i=0;i<a.length;i++){const n=a[i],s=n.type;e.lineJoin="round",s&&("line"===s?E(t,n):B(t,n))}})(this),this.updateCanvasCopy(),this.addCanvasToTarget()},O.prototype.plot=function(t,e){this.clearToolTipData();const a=function(t,e){const a=t.getTarget(),i=e.width,n=e.height;let s=700,l=350;if(i||n)s=i||2*n,l=n||.5*i;else if(a){const t=a.offsetWidth,e=a.offsetHeight;t>e?(s=t,l=t/2):(t||e)&&(s=t||s,l=s/2)}return{width:s,height:l}}(this,e);this.setCanvas(a.width,a.height),this.setStyle(),this.setRawData(t),this.setLayout(e),this.update()},DataVision=O})()})();