/*! For license information please see datavision.min.js.LICENSE.txt */
var DataVision;(()=>{"use strict";var t=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e={};(()=>{function n(t,e){const n=e.x-t.x,i=e.y-t.y;return Math.hypot(n,i)}function i(t,e){const n=Math.min(...e),i=Math.max(...e);return t<n?n:t>i?i:t}function a(t){if("number"!=typeof t||isNaN(t))return t;const e=t.toString().split(".");return e[0]=e[0].toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),e.join(".")}function s(t,e){return"avg"===t?function(t){return t.reduce(((t,e)=>t+e),0)/t.length}(e):"min"===t?Math.min(...e):"max"===t?Math.max(...e):"count"===t?e.length:function(t){return t.reduce(((t,e)=>t+e),0)}(e)}function l(t){return t?t.every((t=>"number"==typeof t)):null}function o(t){if(Number(t)){if(Number.isInteger(Number(t)))return t;{let e=t.toString().split(".")[1].search(/[^0]/);return e&&(e+=1),parseFloat(t.toFixed(e||1))}}return t}function r(t,e,n={x:0,y:0}){const i=Math.PI/180*t;return{x:n.x+e*Math.cos(i),y:n.y+e*Math.sin(i)}}function h(t){if(l(t)){const e=function(t){if(t){const e=t.filter((t=>"number"==typeof t&&!isNaN(t)));if(0===e.length)return;return{min:Math.min(...e),max:Math.max(...e)}}return null}(t);if(e)return[e.min,e.max]}return[null,null]}function c(t,e,n,i,a){!i&&(i="x1"),!a&&(a="y1");const s=t.getLayout().axisData,l=s.labels[i],o=s.values[a];let r=!1,h=!1;if(l){const t=l.range;if(t){const n=t[0],i=t[1];(e<n||e>i)&&(r=!0)}}if(o){const t=o.range;if(t){const e=t[0],i=t[1];(n<e||n>i)&&(h=!1)}}return r||h}function u(t,e,n,i,a){return{x:g(t,e,a),y:d(t,n,i)}}function g(t,e,n){const a=t.getLayout(),s=a.graphPosition,l=s.x,o=s.width;!n&&(n="x1");const r=a.axisData.labels[n];if(r){const n=r.isAllNumbers,a=r.values;if(n)e=function(t,e,n){const a=t.getLayout(),s=a.graphPosition,l=s.x,o=s.width;!n&&(n="x1");const r=a.axisData.labels[n];if(r){const t=r.range;if(t){const n=t[0],a=t[1]-n;return l+(i(e,t)-n)/a*o}}return e}(t,e);else{const t=o/a.length,n=t/2,i=a.indexOf(e);i>=0&&(e=l+(t*i+n))}}return e}function d(t,e,n){const a=t.getLayout(),s=a.graphPosition,l=s.y,o=s.height;!n&&(n="y1");const r=a.axisData.values[n];if(r){const a=r.isAllNumbers,s=r.values;if(a)e=function(t,e,n,a){const s=t.getLayout(),l=s.graphPosition,o=l.y,r=l.height;!n&&(n="y1");const h=s.axisData.values[n];if(h){const t=h.range;if(t){const n=t[0],a=t[1]-n;return o+r-(i(e,t)-n)/a*r}}return e}(t,e,n);else{const t=o/s.length,n=t/2,i=s.indexOf(e);i>=0&&(e=l+o-(t*i+n))}}return e}function x(t,e){let n=Math.round(.5*Math.min(t,e));return n<0&&(n=0),n}function f(t,e,n,i){t&&"object"==typeof t&&(t.addEventListener?(y(t,e,n)||t.addEventListener(e,n,!1),i&&!y(t,i,n)&&t.addEventListener(i,n,!1)):t.attachEvent&&(y(t,e,n)||t.attachEvent("on"+e,n),i&&!y(t,i,n)&&t.attachEvent("on"+i,n)))}function y(t,e,n){return t._eventHandlers&&t._eventHandlers[e]&&t._eventHandlers[e].includes(n)}function m(t,e){return t.length>e?t.substr(0,e>3?e-2:e)+"..":t}function b(t,e){const n=e.width>=0?e.x:e.x+e.width,i=e.height>=0?e.y:e.y+e.height,a=Math.abs(e.width),s=Math.abs(e.height);return t.x<n+a&&t.x+t.width>n&&t.y<i+s&&t.y+t.height>i}function v(t,e){const i=e.radius;return n(t,e.midPoint)<=i}function p(t,e,i){const a=Math.max(e.radius,i),s={midPoint:e.midPoint,radius:a},l=n(t,e.midPoint);return!!v(t,s)&&{dist:l,data:e}}function T(t,e){const n={radius:e.holeRadius,midPoint:e.midPoint};if(v(t,e)&&!v(t,n)){const n=e.startDegrees>0?e.startDegrees:e.startDegrees+360,r=e.midPoint,h=e.endDegrees>0?e.endDegrees:e.endDegrees+360;return i=((i=(l=r,o=t,(Math.atan2(o.y-l.y,o.x-l.x)*(180/Math.PI)+360)%360))+360)%360,(a=((a=n)+360)%360)<=(s=((s=h)+360)%360)?i>=a&&i<=s:i>=a||i<=s}return!1;var i,a,s,l,o}t(e);const A=[{name:"Royal Blue",code:"#4169E1"},{name:"Emerald Green",code:"#008000"},{name:"Coral Orange",code:"#FF6B57"},{name:"Crimson Red",code:"#DC143C"},{name:"Lavender Purple",code:"#E6E6FA"},{name:"Tangerine Orange",code:"#FFA500"},{name:"Turquoise Blue",code:"#40E0D0"},{name:"Bubblegum Pink",code:"#FF69B4"},{name:"Lime Green",code:"#00FF00"},{name:"Amethyst Purple",code:"#9966CC"},{name:"Goldenrod Yellow",code:"#DAA520"},{name:"Aqua Blue",code:"#00FFFF"},{name:"Teal Green",code:"#008080"},{name:"Sapphire Blue",code:"#082567"},{name:"Ruby Red",code:"#E0115F"},{name:"Emerald Green",code:"#50C878"},{name:"Golden Yellow",code:"#FFD700"},{name:"Violet Purple",code:"#8A2BE2"},{name:"Sunshine Yellow",code:"#FFD700"},{name:"Plum Purple",code:"#DDA0DD"}];function P(t){if(!t)return{count:0,range:t};const e=t[0],n=t[1];let i=e,a=n,s=5,l=0;if(!isNaN(i)&&!isNaN(a)){let t=0;i<=0&&a>=0?t=Math.max(Math.abs(e)+Math.abs(n))/Math.max(4,1):i<=0?t=Math.abs(i/Math.max(4,1)):i>0&&(t=a/Math.max(4,1)),l=function(t,e){const n=[1,2,4,5,10],i=Math.pow(10,Math.floor(Math.log10(t)));return n.find((e=>e*i>=t))*i}(t);const o=function(t,e){let n=t[0],i=t[1];return n=e*Math.floor(n/e),i=e*Math.ceil(i/e),[n,i]}([i,a],l);i=o[0],a=o[1];const r=a-i;s=Math.round(r/l),s<=1&&(i=0,s=Math.round(a/l))}return{count:s,range:[i,a],interval:l}}function w(t,e,n){if(n.length>0)for(let t=0;t<n.length;t++){const i=n[t];e.push(i)}else for(var i=0;i<t.length;i++)e.push(i)}function C(t,e,n){const i=e||{},a=A[n].code;return!i.color&&(i.color=a),"line"===t&&Array.isArray(i.color)&&(i.color=a),!i.size&&(i.size=3),i}const D=t=>{!function(t){const e=t.getCtx(),n=t.getLayout(),i=[...t.getData()],a=t.getStyle().label,r=a.fontSize;e.font=r+"px "+a.fontFamily;let c=1,u=0;const g=[],d=[];let x=0;class f{constructor(){this.values=[],this.range=null,this.maxWidth=0,this.tickData=null,this.isAllNumbers=!1}}const y={x1:new f},m={y1:new f,y2:new f},b=["line","bar","scatter","bubble"];let v=!1,p=!1,T=null,A=0,D=0;if(i){const t=[...i],n=t.length,a={labels:[],values:[]},r={type:"bar",dataset:[],attributeIsSet:!1},h=new Map,f=[],P=[];let S=!1;for(let i=0;i<n;i++){const n={...t[i]},M=n.yAxis||"y1",N=n.xAxis||"x1",k="y2"===M?m.y2:m.y1,L=y[N],W=n.name,F=n.labels?n.labels:[],z=n.values?n.values:[],E=n.type,I=n.design||{},B=n.operation;0===F.length&&w(z,F,a.labels),0===z.length&&w(F,z,a.values),a.labels=[...F],a.values=[...z];let R=0,O=0;const H={values:new Map,xAxis:N,yAxis:M},G=[],Y=[],_=[],j={...n},V=[],q=[],J=l(F),X=l(z);if(b.includes(E)){const i=F.length>0?F.length:z.length;let a="",l="";for(let u=0;u<i;u++){const g=F[u],d=X?Number(z[u]):z[u]?z[u]:"";let x=g.length>l.length?e.measureText(o(g)).width:null;const f=X&&d<0&&d>10?-10:d;let y=d.length>a.length?e.measureText(o(f)).width:0;if("bar"===E){if(!r.attributeIsSet){for(let e=0;e<t.length;e++){const n=t[e];"bar"===n.type&&("hr"===n.direction&&(r.direction="hr"),"stack"===n.mode&&(r.mode="stack"))}r.attributeIsSet=!0}const a="hr"===r.direction,l=a?g:d,x=a?d:g,f=a?X:J;r.labelIsAllNumbers=f;let m=[l];if(H.values.has(x)&&(m=H.values.get(x),m.push(l)),(f||x.toString().length>0)&&(m.length>c&&(c=m.length),H.values.set(x,m),"hr"===n.direction&&(T="hr"),S=!0),u===i-1){if(a?X:J){let t=Array.from(H.values.keys());t.sort(((t,e)=>t-e));for(let e=0;e<t.length;e++){const n=t[e],i=t[e!==t.length-1?e+1:null];let a=i?Math.abs(i-n):null;const s=r.barSize;a&&(s?s>a&&(r.barSize=a):r.barSize=a)}}(X||J)&&H.values.forEach(((t,n)=>{let i=s(B,t);if(isNaN(i)&&(i=t[0]),y=e.measureText(o(i)).width,H.values.set(n,i),"stack"===r.mode){const t=h.has(n)?h.get(n):[0,0];i=(i>=0?t[0]:t[1])+i;const e=i>=0?[i,t[1]]:[t[0],i];h.set(n,e)}a?L.values.push(i):k.values.push(i)}))}J&&!X&&!a&&L.values.push(g),X&&!J&&a&&k.values.push(d)}else{if(G.includes(g)&&X){const t=_[G.indexOf(g)];t&&!isNaN(d)&&t.push(d)}else if(Y.includes(d)&&!X&&J){const t=_[Y.indexOf(d)];t&&!isNaN(g)&&t.push(g)}else G.push(g),Y.push(d),X?_.push([d]):J&&_.push([g]);if(u===i-1)for(let t=0;t<_.length;t++){const n=_[t],i=s(B,n);isNaN(i)||(X?(y=e.measureText(o(i)).width,Y[t]=i,k.values.push(i)):(x=e.measureText(o(i)).width,G[t]=i,L.values.push(i)))}}x>R&&(R=x,l=g),y>O&&(O=y,a=d),(!J||X)&&L.values.push(g),(!X||J)&&k.values.push(d)}L.maxWidth=R>L.maxWidth?R:L.maxWidth,k.maxWidth=O>k.maxWidth?O:k.maxWidth,k.isAllNumbers=X,L.isAllNumbers=J,v=!0;const u=W||"Dataset "+x,d=e.measureText(u).width;"bar"===E?(f.push(u),H.design=C(E,I,x),H.design.color&&P.push(Array.isArray(H.design.color)?H.design.color[0]:H.design.color),r.dataset.push(H)):(n.name=u,n.values=Y,n.labels=G,n.design=C(E,I,x),g.push(n)),d>A&&(A=d),D+=1,x++}else if("pie"===E){for(let t=0;t<z.length;t++){const n=F[t],i=z[t];if(i>=0&&n){const t=e.measureText(n).width;V.includes(n)?q[V.indexOf(n)].push(i):(V.push(n),q.push([i])),t>u&&(u=t)}}p=!0,j.labels=V,j.values=q,j.type="pie",d.push(j),u>A&&(A=u),D+=V.length}L&&(L.values=[...new Set(L.values)]),k&&(k.values=[...new Set(k.values)])}S&&(r.names=f,r.colors=P,r.direction=T,g.unshift(r))}const S=(t,i)=>{for(let a in t){const s=t[a],r=s.values,c=s.maxWidth,u=l(r);let g=h(r);if("values"===i){if("y2"===a){if(n.y2Axis){const t=n.y2Axis.range;!t||(g=t)}}else if(n.yAxis){const t=n.yAxis.range;!t||(g=t)}}else if(n.xAxis){const t=n.xAxis.range;!t||(g=t)}const d=P(g),x=d.range,f=o(x[0]),y=o(x[1]),m=f&&!isNaN(f)?e.measureText(f).width:0,b=y&&!isNaN(f)?e.measureText(y).width:0,v=Math.max(c,Math.max(m,b));s.maxWidth=v,s.range=d.range,s.tickData=d,s.isAllNumbers=u}},M=[...g,...d];S(m,"values"),S(y),n.datasetNameData={isDatasetName:D>1,maxNameWidth:A,total:D},n.axisData={labels:y,values:m,direction:T},n.hasAxisData=v,n.hasPieData=p,t.setData(M)}(t),function(t){t.getCtx();const e=t.getCanvas(),n=e.width,i=e.height,a=t.getLayout(),s=t.getStyle(),l=s.title.fontSize,o=s.label.fontSize,r=t.getLayout().titleLines;let h=0;r.length>0&&(h=(r.length+1)*l);const c=a.axisData,u=c.labels,g=c.values,d=2*o,x=.15*n;let f=x,y=x;const m=g.y1.maxWidth;m<f&&(f=m+d),a.yAxis&&a.yAxis.title&&(f+=d);const b=g.y2.maxWidth;b<y&&(y=0===b?0:b+d),a.y2Axis&&a.y2Axis.title&&b>0&&(y+=2*o);let v=.15*n;const p=a.datasetNameData,T=p.isDatasetName,A=p.maxNameWidth;v=T?A<v?A+d:.2*n:0;let P=d+o,w=0;const C=n-(f+y+v),D=u.x1,S=D.maxWidth,M=C/D.values.length;if(w=D.isAllNumbers?S:0,M/o<4){const t=.3*i;P+=S>t?t:S}a.xAxis&&a.xAxis.title&&(P+=d);const N={x:f,y:h,width:n-(f+y+v+w),height:i-(h+P),yAxisRight:y,yMaxLabelWidth:x};t.layout={...a,graphPosition:N}}(t);const e=t.getLayout();(t=>{const e=t.getCtx(),n=t.getLayout(),i=t.getStyle().title,a=t.getCanvas().width,s=n.graphPosition.y;let l=n.titleLines;if(e.textAlign="center",l){const t=i.fontSize;e.font=t+"px "+i.fontFamily;let n=a/2,o=s/2+t/2;l.length>1&&(o=t);for(let i=0;i<l.length;i++){const a=l[i];e.beginPath(),e.fillText(a,n,o),e.closePath(),o+=t}}})(t),(t=>{const e=t.getCtx(),n=t.getLayout(),i=t.getStyle().label,a=e.canvas,s=a.width,l=a.height,o=i.fontSize;e.font=o+"px "+i.fontFamily;const r=n.graphPosition,h=r.x,c=r.y,u=r.width,g=r.height,d=.2*s,x=l-c,f=h+u+r.yAxisRight+o,y=n.datasetNameData.total,b=t.getData();let v=!1;if(1===b.length){const t=b[0];"bar"===t.type&&t.names.length>1&&(v=!0)}if(b.length>1||!n.hasAxisData||v){let t=c+o/2;for(let n=0;n<b.length;n++){const i=b[n];if(i){let n=i.labels;const a=i.type;let s=i.colors;if(["line","bar","scatter","bubble"].includes(a))if("bar"===a)n=i.names,s=i.colors;else{n=[i.name];const t=i.design.color;s=Array.isArray(t)?t:[t]}if(n){let i=2*o;y*(2*o)>=g+o/2&&(i=Math.round(x/y));for(let a=0;a<n.length;a++){const l=A[a].code;let r=n[a];const h=e.measureText(r).width;if(h+i>d&&r.length>3){const t=h/r.length;r=m(r,Math.floor((d-2*o)/t))}const c=(s?s[a]:null)||l;c&&(e.fillStyle=c);const u=f+o,g=t;e.beginPath(),e.arc(f,t,o/2,0,2*Math.PI),e.fill(),e.beginPath(),e.fillStyle="black",e.textAlign="start",e.textBaseline="middle",e.fillText(r,u,g),t+=i}}}}}})(t),e.hasAxisData&&(t=>{const e=t.getCtx(),n=t.getLayout().graphPosition;e.beginPath(),e.strokeStyle="#b5b5b5",e.lineWidth="0.1",e.rect(n.x+1,n.y,n.width-2,n.height),e.stroke(),e.lineWidth="1",function(t,e){const n=t.getCtx(),i=t.getLayout(),s=t.getCanvas(),l=(s.width,s.height),r=t.getStyle().label,h=e.width,c=e.height,u=e.x,g=e.y,d=r.fontSize;n.font=d+"px "+r.fontFamily,n.textBaseline="hanging";let x=0,f=g+c;const y=i.axisData.labels;for(let t in y){const e=y[t],i=e.values;if(e.isAllNumbers){const t=e.tickData;i.sort(((t,e)=>t-e));let s=e.range;if(s){const e=s[0],i=s[1],l=t.interval;let r=t.count,y=h/r;y<1&&(y=1);let m=0;const b=n.measureText(i).width;let v=1;b>y&&(v+=Math.round(b/y)),n.textAlign="center";for(let t=0;t<=r;t+=v){m=a(o(e+l*t)),x=u+y*t,n.measureText(m).width;const i=x,s=f+d;n.beginPath(),n.strokeStyle="0"===m?"black":"#b5b5b5",n.moveTo(x,g),n.lineTo(x,g+c+d/2),n.stroke(),n.beginPath(),n.fillText(m,i,s)}}}else{const t=e.maxWidth;let a=h/i.length;a<1&&(a=1);let s=1;for(var b=0;b<i.length;b+=s){x=u+(a/2+a*b);let e=x;const s=f+d;n.beginPath(),n.textAlign="center";let o=i[b],r=0;const h=n.measureText(o).width/o.length;a/d<4?(o=m(o,(l-(g+c))/h),r=-90,e=x,n.textAlign="end",n.textBaseline="middle"):t>a&&(o=m(o,a/h));let y=r*(Math.PI/180);n.save(),n.translate(e,s),n.rotate(y),n.fillText(o,0,0),n.restore()}}}n.textAlign="start",n.textBaseline="alphabetic"}(t,n),function(t,e){const n=t.getCtx(),i=(t.getCanvas(),t.getLayout()),s=t.getStyle().label,l=e.width,r=e.height,h=e.x,c=e.y,u=e.yMaxLabelWidth,g=s.fontSize;n.font=g+"px "+s.fontFamily;let d=h,x=c+r;const f=i.axisData,y=(f.direction,f.values);for(let t in y){const e=y[t],i=e.values;if(e.isAllNumbers){const s=e.tickData;i.sort(((t,e)=>t-e));let u=e.range;if(u){const e=u[0],i=s.interval;let f=s.count,y=r/f;y<1&&(y=1);let m=0,b=1;g>y&&(b+=Math.round(g/y));for(let s=0;s<=f;s+=b){m=a(o(e+i*s)),x=c+r-y*s;const u=n.measureText(m).width,f="y2"===t?d+l+g:d-u-g,b=x+Math.floor(g/2);n.beginPath(),n.strokeStyle="0"===m?"black":"#b5b5b5","y2"===t?(n.moveTo(h+l,x),n.lineTo(h+l+g/2,x)):(n.moveTo(h+l,x),n.lineTo(h-g/2,x)),n.stroke(),n.beginPath(),n.fillText(m,f,b)}}}else{const a=e.maxWidth;let s=r/i.length;s<1&&(s=1);let o=1;g>s&&(o+=Math.round(g/s));for(var b=0;b<i.length;b+=o){x=c+r-(s/2+s*b);let e=i[b];const o=n.measureText(e).width/e.length;a>u-g&&(e=m(e,(u-g)/o));const h="y2"===t?d+l+g:d-g,f=x;n.beginPath(),n.textAlign="y2"===t?"start":"end",n.textBaseline="middle",n.fillText(e,h,f),n.textAlign="start",n.textBaseline="alphabetic"}}}}(t,n),function(t,e){const n=t.getCtx(),i=t.getLayout(),a=t.getStyle().label,s=n.canvas.height,l=e.width,o=e.height,r=e.x,h=e.y,c=e.yAxisRight;let u=i.yAxis,g=i.y2Axis,d=i.xAxis;n.textAlign="center";const x=a.fontSize;if(n.font=x+"px "+a.fontFamily,u){let t=u.title;if(t){n.beginPath();let e=Math.PI/180*-90;n.save(),n.translate(x,h+o/2),n.rotate(e),n.fillText(t,0,0),n.restore()}}if(g){let t=g.title;if(t){n.beginPath();let e=Math.PI/180*-90;n.save(),n.translate(r+l+c-x,h+o/2),n.rotate(e),n.fillText(t,0,0),n.restore()}}if(d){let t=d.title;t&&(n.beginPath(),n.fillText(t,r+l/2,s-x/2))}}(t,n)})(t),e.hasPieData&&(t=>{const e=t.getCtx(),n=t.getLayout().graphPosition,i=n.x,a=n.y,s=n.width,l=x(s,n.height),o=i+s/2,r=a+l;e.beginPath(),e.arc(o,r,l,0,2*Math.PI),e.stroke()})(t)},S=(t,e,n,a,s,l,o)=>{const r=t.getCtx(),h=t.getLayout(),c="hr"===e.direction,u=h.axisData,x=u.values[e.yAxis],f=u.labels[e.xAxis],y="y2"===e.yAxis?"y2Axis":"yAxis",m=h.xAxis?h.xAxis.title:null,b=h[y]?h[y].title:null,v=h.graphPosition,p=v.x,T=v.y,A=v.height;let P=c?f.range:x.range;const w=i(0,P),C=(P?c?g(t,w):d(t,w):null)||(c?p:T+A);if(c){const e=l,i=C,h=d(t,a)+o*l/2-e*n-e,c=g(t,s)-C,u=e;r.beginPath(),r.rect(i,h,c,u),r.fill(),t.setToolTipData({type:"bar",x:i,y:h,width:c,height:u,label:a,value:s,labelTitle:m,valueTitle:b})}else{const e=l;let i=g(t,a)-o*l/2+e*n;const h=d(t,s),c=i,u=h,x=e,f=C-h;r.beginPath(),r.rect(c,u,x,f),r.fill(),t.setToolTipData({type:"bar",x:c,y:u,width:x,height:f,label:a,value:s,labelTitle:m,valueTitle:b})}},M=(t,e,n,i,a,s,l)=>{const o=t.getCtx(),r=t.getLayout(),h="hr"===e.direction,c=r.axisData,u=c.values[e.yAxis],x=c.labels[e.xAxis],f="y2"===e.yAxis?"y2Axis":"yAxis",y=r.xAxis?r.xAxis.title:null,m=r[f]?r[f].title:null,b=r.graphPosition,v=b.x,p=b.y,T=(b.width,b.height),A=((h?x.range:u.range)?h?g(t,a):d(t,a):null)||(h?v:p+T);if(h){const e=n,a=A,r=d(t,i)+n/2-e,h=g(t,s)-A,c=e;o.beginPath(),o.rect(a,r,h,c),o.fill(),t.setToolTipData({type:"bar",x:a,y:r,width:h,height:c,label:i,value:l,labelTitle:y,valueTitle:m})}else{const e=n;let a=g(t,i)-n/2;const r=d(t,s),h=a,c=r,u=e,x=A-r;o.beginPath(),o.rect(h,c,u,x),o.fill(),t.setToolTipData({type:"bar",x:h,y:c,width:u,height:x,label:i,value:l,labelTitle:y,valueTitle:m})}},N=(t,e,n,i,a,s)=>{const l=e.mode,o=t.getCtx();o.lineWidth=i,a&&("start"===n?(o.beginPath(),o.moveTo(a.x,a.y)):o.lineTo(a.x,a.y),"scatter"!==l||s||(o.stroke(),o.closePath(),o.beginPath(),o.arc(a.x,a.y,i/2||1,0,2*Math.PI),o.stroke(),o.closePath(),o.beginPath(),o.moveTo(a.x,a.y))),"end"===n&&(o.stroke(),o.closePath())},k=(t,e,n)=>{const i=t.getCtx();n&&(i.beginPath(),i.arc(n.x,n.y,e,0,2*Math.PI),i.stroke(),i.fill(),i.closePath())},L=(t,e,n,i,a,s,l,o)=>{const h=t.getLayout().graphPosition,c=h.x,u=h.y,g=h.width,d=x(g,h.height),f=c+g/2,y=u+d,m=r(n,d,{x:f,y}),b={x:f,y},v=r(i,d,{x:f,y}),p=Math.PI/180,T=n*p,A=i*p;e.beginPath(),e.strokeStyle="white",e.lineWidth=4,e.lineCap="round",e.lineJoin="round",e.arc(b.x,b.y,d,T,A),e.moveTo(m.x,m.y),e.lineTo(b.x,b.y),e.lineTo(v.x,v.y),e.stroke(),e.fill(),e.closePath(),t.setToolTipData({type:"pie",radius:d,startDegrees:n,endDegrees:i,startAngle:T,endAngle:A,midPoint:b,holeRadius:a,label:s,value:l,percent:o})},W=(t,e)=>{const n=t.getCtx(),a=t.getLayout(),l=e.type,r=e.mode;if("bar"===l){const s=a.axisData,l=e.dataset,o="hr"===e.direction,h=l.length,c=a.graphPosition,u=o?c.height:c.width,g=new Map;for(let a=0;a<l.length;a++){const c=l[a];c.direction=e.direction;const d=s.values[c.yAxis],x=s.labels[c.xAxis],f=u/x.values.length;let y="stack"===r?.7*f:f/(h+1);const m=o?d:x;if(m.isAllNumbers){const t=m.range,n=t[0],i=t[1]-n,a=e.barSize;a&&(y=a/i*u)}const b=c.design.color;n.fillStyle=b;let v=0;const p=i(0,o?x.range:d.range);c.values.forEach(((e,i)=>{if(Array.isArray(e)&&(e=e[0]),Array.isArray(b)&&(n.fillStyle=b[v>=b.length?0:v]),"stack"===r){const n=g.has(i)?g.get(i):[p,p],s=e>=0?n[0]:n[1],l=e,o=(e=0===a?e:s+e)>=0?[e,n[1]]:[n[0],l];g.set(i,o),M(t,c,y,i,s,e,l)}else S(t,c,a,i,e,y,h);v++}))}}else if("pie"===l){const i=t.getTempCanvas();i.width=n.canvas.width,i.height=n.canvas.height;const l=i.getContext("2d"),r=a.graphPosition,c=r.x,u=r.y,g=r.width,d=r.height,x=Math.min(g,d)/2,f=e.values?e.values:[],y=e.colors,m=e.operation;let b=0;const v=[];f.forEach((t=>{const e=s(m,t);v.push(e),b+=e}));const p=(e.hole?e.hole:0)*x;if(v){let n=-90,i=n;for(var h=0;h<v.length;h++){const a=A[h].code,s=(y?y[h]:null)||a;s&&(l.fillStyle=s);const r=v[h],c=e.labels[h];if(!isNaN(r)){const e=r/b;n+=360*e;const a=n,s=o(100*e);L(t,l,i,a,p,c,r,s),i=a}}}const T=g/2,P=d/2;l.globalCompositeOperation="destination-out",l.globalAlpha=1,l.beginPath(),l.arc(c+T,u+P,p,0,2*Math.PI),l.fill(),l.globalCompositeOperation="source-over",n.drawImage(i,0,0)}else if(e){const i=e.yAxis?e.yAxis:"y1",s=e.xAxis?e.xAxis:"x1",o="y2"===i?"y2Axis":"yAxis",r=a.xAxis?a.xAxis.title:null,g=a[o]?a[o].title:null,d="hr"===e.direction,x=e.design.color,f=e.design.size,y=e.design.text;n.fillStyle=x,n.strokeStyle=x;const m=d?e.values:e.labels,b=d?e.labels:e.values?e.values:[];if(m){let a,o={x:null,y:null};for(h=0;h<m.length;h++){let d=m[h],v=b[h];const p=Array.isArray(x)?x[h]?x[h]:x[0]:x,T=Array.isArray(f)?f[h]:f,A=Array.isArray(y)?y[h]:y;if(a=0===h?"start":h===m.length-1?"end":"",v||0===v){const h=u(t,d,v,i,s),x=c(t,d,v,s,i);if("line"===l){if(x&&(h.x===o.x||h.y===o.y)){n.stroke(),n.closePath();break}x||(N(t,e,a,T,h,x),o=h)}else if(("scatter"===l||"bubble"===l)&&!x){const i=e.design.line,a=i&&i.color?i.color:p,s=i&&i.size?i.size:0;n.fillStyle=p,n.strokeStyle=a,n.lineWidth=s,k(t,T,h)}!x&&t.setToolTipData({type:l,radius:T,midPoint:h,label:d,value:v,labelTitle:r,valueTitle:g,size:"bubble"===l?T:null,sizeTitle:A,color:p})}else n.stroke(),n.closePath()}}}},F=(t,e)=>{e&&W(t,e)},z=(t,e)=>{e&&W(t,e)},E=(t,e,n,i)=>{if(!t[n]&&0!==t[n])return{text:null,width:0};const s=e.canvas.width;let l=t[n+"Text"],r=t[n+"Width"];if(!r){let h=a(o(t[n]));const c=e.measureText(h).width,u=c>s?.9*s:c;h=m(h,u/(c/h.length));let g=t[n+"Title"];g&&(g=m(g,(s-u-i||0)/(e.measureText(g).width/g.length))+": "),l=(g?g+" ":"")+h+(t.percent&&"value"===n?" ("+t.percent+"%)":""),r=e.measureText(l).width}return t[n+"Text"]=l,t[n+"Width"]=r,{text:l,width:r}},I=(t,e,n,i)=>{((t,e,n)=>{e.beginPath(),e.strokeStyle="#000",e.lineWidth=1,"bar"===n.type?e.rect(n.x,n.y,n.width,n.height):"pie"===n.type?(e.strokeStyle="rgba(0, 0, 0, 0.1)",e.lineWidth=.0063*e.canvas.width,e.arc(n.midPoint.x,n.midPoint.y,n.radius-4,n.startAngle,n.endAngle)):"line"===n.type?(e.strokeStyle=n.color||"#000",e.fillStyle=n.color||"transparent",e.arc(n.midPoint.x,n.midPoint.y,n.radius+1,0,2*Math.PI),e.fill()):e.arc(n.midPoint.x,n.midPoint.y,n.radius,0,2*Math.PI),e.stroke()})(0,e,i);const a=t.getStyle().label.fontSize,s=a/2,l=E(i,e,"label",a),o=E(i,e,"value",a),r=E(i,e,"size",a),h=Math.max(l.width,o.width,r.width)+a,c=a*(r.text?5:3.5);let u=n.x+20,g=n.y+25;const d=h,x=c,f=u+d,y=g+x;f>e.canvas.width&&(u=d+a+20<n.x?n.x-(d+20):n.x+20-(f-e.canvas.width)),y>e.canvas.height&&(g=n.y-(x+20)),e.beginPath(),e.fillStyle="#b5b5b5",e.fillRect(u,g,d,x),e.fillStyle="#fff",e.fillRect(u+1,g+1,d-2,x-2),e.fillStyle="#000",e.font=a+"px Arial",e.textBaseline="top",e.textAlign="left",e.fillText(l.text,u+s,g+s),e.fillText(o.text,u+s,g+2*a),r.text&&e.fillText(r.text,u+s,g+3*a+s)};function B(t){this.data=[],this.layout={},this.style={},this.target=document.getElementById(t),this.targetCanvas=document.createElement("canvas"),this.canvas=document.createElement("canvas"),this.canvasCopy=document.createElement("canvas"),this.ctx=null,this.tempCanvas=document.createElement("canvas"),this.toolTipData=[],this.setData=function(t){this.data=t},this.getData=function(){return this.data},this.setLayout=function(t){if(t){const e=t.title?t.title:"";t.titleLines=function(t,e){const n=t.getCanvas(),i=t.getCtx(),a=t.getStyle().title,s=n.width,l=e.split(" ");let o=[],r=l[0];const h=a.fontSize;i.font=a.fontWeight+" "+h+"px "+a.fontFamily;for(let t=1;t<l.length;t++){const e=r+" "+l[t];i.measureText(e).width+h<s?r=e:(i.measureText(r).width,o.push(r),r=l[t])}return o.push(r),o}(this,e),t.customColorsIndex=0,this.layout={...t}}},this.getLayout=function(){return this.layout},this.setStyle=function(){this.style=(t=>{const e=t.getCanvas().width,n={fontFamily:"Helvetica Neue, Helvetica, 'Arial, sans-serif",fontWeight:"bold"},i={fontFamily:"Helvetica Neue, Helvetica, 'Arial, sans-serif"};return e<600?(n.fontSize=16,i.fontSize=12):e<1200?(n.fontSize=20,i.fontSize=14):(n.fontSize=24,i.fontSize=18),{title:n,label:i}})(this)},this.getStyle=function(){return this.style},this.setCanvas=function(t,e){const n=this.getCanvas();n.width=t,n.height=e,this.canvas=n,this.ctx=n.getContext("2d")},this.getCanvas=function(){return this.canvas},this.setToolTipData=function(t){this.toolTipData.push(t)},this.getToolTipData=function(){return this.toolTipData},this.clearToolTipData=function(){this.toolTipData=[]},this.updateCanvasCopy=function(){const t=this.getCanvas(),e=this.getCanvasCopy();e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),this.canvasCopy=e},this.getCanvasCopy=function(){return this.canvasCopy},this.getCtx=function(){return this.ctx},this.getTempCanvas=function(){return this.tempCanvas},this.getTarget=function(){return this.target},this.getTargetCanvas=function(){return this.getTarget().getElementsByTagName("canvas")[0]},this.updateTargetCanvas=function(){const t=this.getCanvasCopy(),e=this.getCtx();e.clearRect(0,0,e.canvas.width,e.canvas.height),e.drawImage(t,0,0)},this.addCanvasToTarget=function(){const t=this.getCanvas(),e=this;f(t,"mousemove",(function(t){t.stopPropagation();const n=function(t){if(t){const e=t.target.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}return null}(t);((t,e,n)=>{if(e&&n){const n=e.getCtx();var i=n.canvas.getBoundingClientRect(),a=t.clientX-i.left,s=t.clientY-i.top;e.updateTargetCanvas();const l=[...e.getToolTipData()].reverse(),o={x:a,y:s,width:1,height:1};let r=null;for(let t=0;t<l.length;t++){const i=l[t],h=i.type;if("bar"===h){if(b(o,i)){I(e,n,{x:a,y:s},i),r=null;break}}else if("pie"===h){if(T(o,i)){I(e,n,{x:a,y:s},i),r=null;break}}else{if(v(o,i)){I(e,n,{x:a,y:s},i),r=null;break}{const t=p(o,i,22);t&&(r?r.dist>t.dist&&(r=t):r=t)}}}r&&I(e,n,{x:a,y:s},r.data)}})(t,e,n)}),"click"),f(document,"click",(function(){e.updateTargetCanvas()}),"touchend"),this.target&&(this.target.innerHTML="",this.target.appendChild(t))}}B.prototype.plot=function(t,e){this.clearToolTipData();const n=function(t,e){const n=t.getTarget(),i=e.width,a=e.height;let s=0,l=0;return n&&(s=Math.max(n.offsetWidth,n.offsetHeight),l=.6*s),(i||a)&&(s=i,l=a),{width:s,height:l}}(this,e);this.setCanvas(n.width,n.height),this.setStyle(),this.setData(t),this.setLayout(e),D(this),(t=>{const e=t.getCtx(),n=t.getData();for(let i=0;i<n.length;i++){const a=n[i],s=a.type;e.lineJoin="round",s&&("line"===s?z(t,a):F(t,a))}})(this),this.updateCanvasCopy(),this.addCanvasToTarget()},DataVision=B})()})();